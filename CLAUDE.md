# Claude Code 作業方針

## 目的
Claude Code の作業方針とプロジェクト固有ルールを定義します。

## 判断記録のルール
1. 判断内容の要約を記載する
2. 検討した代替案を列挙する
3. 採用しなかった案とその理由を明記する
4. 前提条件・仮定・不確実性を明示する
5. 他エージェントによるレビュー可否を示す

前提・仮定・不確実性を明示し、仮定を事実のように扱わない。

## プロジェクト概要
- **目的**: Discord チャンネルの移動を検出し、自動的に元の位置に戻す
- **主な機能**: チャンネル位置のロック、自動復元、スラッシュコマンドによる制御

## 重要ルール
- **会話と言語**:
  - 会話は日本語で行う
  - コード内コメントは日本語で記載する
  - エラーメッセージは英語で記載する
  - 日本語と英数字の間には半角スペースを入れる
- **コミットと PR**:
  - [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/) に従い、説明は日本語で記載する
  - ブランチ名は `feat/description` や `fix/description` の形式とする

## 環境のルール
- **ブランチ命名**: [Conventional Branch](https://conventional-branch.github.io) に従う
- **リポジトリ調査**: 必要に応じてリポジトリ内を検索し、既存のパターンを理解する
- **Renovate**: Renovate が作成した PR に対して追加コミットや更新を行わない

## Git Worktree
使用する場合は以下の構成とする：
- `.bare/` (bare リポジトリ)
- `<branch>/` (各ブランチの worktree)

## コード改修時のルール
- エラーメッセージの絵文字統一：既存のメッセージに絵文字がある場合は、適切な一文字の絵文字を先頭に付ける
- TypeScript: `skipLibCheck` を有効にしてエラーを回避することは禁止
- docstring: 関数やインターフェースには日本語で docstring を記載・更新する

## 相談ルール
- Codex CLI: 実装レビュー、局所設計、整合性確認
- Gemini CLI: 外部仕様、最新情報確認
- 指摘への対応：信頼度スコア 50 以上の指摘には必ず対応する（黙殺禁止）

## 開発コマンド
```bash
# インストール
pnpm install

# 開発
pnpm dev

# 実行
pnpm start

# Lint / 型チェック
pnpm lint

# 自動修正
pnpm fix

# ビルド / パッケージング
pnpm package
```

## アーキテクチャと主要ファイル
- `src/main.ts`: エントリーポイント
- `src/discord.ts`: Discord クライアントの管理
- `src/commands/`: スラッシュコマンドの実装
- `src/events/`: Discord イベント（チャンネル移動、作成等）のハンドラ
- `src/manager/`: チャンネル位置の管理、自動ロック等のロジック

## 実装パターン
- `@book000/node-utils` の `Logger`, `ConfigFramework` を活用する
- スラッシュコマンドは `src/commands` に追加し、`src/discord.ts` で `./commands/*` を import して `Discord.routes` に列挙して登録する

## テスト
- 現在テストコードはないが、重要なロジックについてはテストの追加を検討する

## ドキュメント更新ルール
- 設定項目の変更時は `schema/Configuration.json` を更新し、必要に応じて `README.md` も更新する

## 作業チェックリスト

### 新規改修時
1. プロジェクトを理解する
2. 作業ブランチが適切であることを確認する
3. 最新のリモートブランチに基づいた新規ブランチであることを確認する
4. 不要なブランチが削除済みであることを確認する
5. `pnpm install` で依存関係をインストールする

### コミット・プッシュ前
1. Conventional Commits に従っていることを確認する（説明は日本語）
2. センシティブな情報が含まれていないことを確認する
3. `pnpm lint` でエラーがないことを確認する
4. 動作確認を行う

### PR 作成前
1. PR 作成の依頼があることを確認する
2. センシティブな情報が含まれていないことを確認する
3. コンフリクトの恐れがないことを確認する

### PR 作成後
1. コンフリクトがないことを確認する
2. PR 本文が最新状態を網羅していることを確認する（日本語）
3. GitHub Actions の結果を確認する
4. Copilot レビューやコードレビューの指摘に対応する

## リポジトリ固有
- Docker 環境での動作を考慮し、設定ファイルやデータの永続化パス（`data/`）に留意する
- Discord API のレート制限を考慮した実装を行う
